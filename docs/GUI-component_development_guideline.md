アトミックデザインが馴染まなかったのでUIコンポーネント作成ガイドライン考えてみた
-------------

- Table of Content
{:toc}

# はじめに

本記事では、UIコンポーネント作成における手法について記述します。

完璧を目指すものではなく、あくまで個人的なメモとしての位置づけです。

# 発端

※読み飛ばしても構いません。

## アトミックデザインが馴染まなかった

UIデザインにおいて、アトミックデザインという手法がよく知られています。おおよその構成は以下の通りです。

種類                    | 説明 | 例
---------------------   |---------------------|---------------------
Atom(原子)           | 最も基本的な要素で個々のUI部品。単体で機能する最小の部品。 | ボタンや入力フィールド、ラベル、アイコン
Molecule(分子) | AtomやMoleculeを組み合わせて作られるより複雑な要素。複数のAtomが組み合わさって特定の機能を持つ小さな部品。| 入力フォーム（ラベル + 入力フィールド）、カードコンポーネント（画像 + タイトル + テキスト）
Organism(有機体) |Moleculeを組み合わせて構築されるより大きなUIコンポーネント。一定の機能を果たす独立した部品として使えることが多い。 | ナビゲーションバー（ロゴ + メニュー項目）、記事のサンプル（タイトル + メタ情報 + 本文）
Template(テンプレート) | Organismを使ってPageのレイアウトを構築する段階。TemplateはPage全体の構造を決定する。具体的なコンテンツが埋め込まれる前の状態。| ヘッダー、サイドバー、コンテンツ領域、フッターを組み合わせたページレイアウト
Page(ページ)           | ページとして完成した状態。Templateに実際のコンテンツ（テキスト、画像など）が埋め込まれる。| 実際のブログ記事ページ、製品詳細ページ、ユーザーのプロフィールページ

なんとなく分かるような気がしますが、実践してみると

- これはMolecule？ Organism？
- これはAtom？ Molecule？
- Moleculeが増えすぎている
- パラメータはどうするのが適切？

などの混乱が生じました。

単にアトミックデザインへの理解が足りないだけかもしれません。しかし、実際にUIコンポーネント作成において混乱が生じてスマートな作りにはなりませんでした。

Webで調べてみると、アトミックデザインの採用をやめたという記事がいくつも見つかります。例えば「Why so many Design Systems using Atomic Design fail to succeed?」という記事がすぐに見つかりました。

どうやらアトミックデザインの困難さは私だけが感じているものではないようです。

## UIコンポーネント作成のガイドラインはほしい

とはいえUIコンポーネント作成において何かしらのガイドラインが必要だと感じました。

そこで自分なりにUIコンポーネント作成のガイドラインについて考えてみることにしました。

# UIコンポーネント作成ガイドライン

## 基本的な方針

- シンプルな理解しやすいUIコンポーネントを作成する。
- 各UIコンポーネントが持つ責任を明確にし、必要な部分を分けて作成する。
- UIコンポーネントを **ビューコンポーネント** (データの表示)、**パーツコンポーネント** (見た目や動きに特化) のどちらかにする。

## 設計の手順

1. **大元となるビューコンポーネントの抽出**
   - まず表示対象のページ全体に相当するビューコンポーネントを抽出します。

2. **ビューコンポーネント内の配置と装飾の抽出**
   - ビューコンポーネント内で、**配置と装飾（テンプレート）** コンポーネントとして抽出できないか検討します。

3. **部分的なビューコンポーネントの抽出**
   - ビューコンポーネント内で、独立して扱うべき部分を別のビューコンポーネントとして抽出します。これは局所的にとても複雑な部分や文脈的に独立性が高い部分です。

4. **繰り返し**
   - 必要に応じて、(2.)、(3.)を繰り返し、ビューコンポーネントを細かく分けていきます。過度に細かくする必要はありません。理解が容易なレベルになれば十分です。

5. **パーツコンポーネントの抽出**
   - ビューコンポーネントの抽出が完了したら、各ビューコンポーネント内で**配置と装飾（テンプレート）**、**表示ギミック**、**基礎的なパーツ**といったパーツコンポーネントを抽出します。フレームワークが提供しているコンポーネントでも最低限のプロパティ指定で使えるのであればそのまま使ってもかまいません。

## UIコンポーネントの種類

- **ビューコンポーネント**：
  - データの表示に特化し、APIやDBからのデータをレンダリングします。
  - データを整形し、適切なパーツコンポーネントを組み合わせます。

- **パーツコンポーネント**：
  - ビューコンポーネントを構成する部品で、**配置と装飾（テンプレート）**、**表示ギミック**、**基礎的なパーツ**に分類されます。

UIコンポーネントの詳細は [UIコンポーネントの分類](#uiコンポーネントの分類) を参照してください。

### パーツコンポーネントの分類

1. **配置と装飾（テンプレート）**
   - 子要素の配置や背景、枠線などを担当します。

2. **表示ギミック**
   - 動的な表示やインタラクションに関わる仕掛け。例：モーダル、アコーディオン、トースト、タブなど。

3. **基礎的なパーツ**
   - 基本的なUI部品。構築を簡単にし、パーツとして独立して使えるもの。例：
     - 並び方と余白（List、Table、Flexboxなど）
     - ボタン、入力要素（input、select、checkbox、textboxなど）
     - テキスト（強調、修飾など）
     - 画像・図形（アイコン、画像、QRコードなど）

次にこのガイドラインでのUIコンポーネントについて示します。

# UIコンポーネントの分類

ガイドライン作成にあたってUIコンポーネントの分類を見直しました。

UIコンポーネントの分類を見直すことで、UIコンポーネント間の役割や使い方がより明確になり、開発が効率的になると考えたためです。

## DBやAPIから受け取ったデータを表示 or 組み合わせて使うパーツ

UIコンポーネントを分類するにあたり、次の2つの特性がシンプルで大きな違いだと考えました。

- (a) DBやAPIから受け取ったデータを表示
- (b) 別のUIコンポーネントを差し込んで表示 (複数のUIコンポーネントの組み合わせを想定)

これらは実装の観点で読み替えると次のようになります。

- (a) コンテンツ用プロパティはプリミティブ型 (文字列や数値など)、オブジェクト、配列である (JSX要素やHTML要素ではない)
- (b) コンテンツ用プロパティは基本的にコンテンツスロットである (JSX要素やHTML要素である)

コンテンツ用プロパティの指定を必要としないUIコンポーネントもありますが、その場合は(a)や(b)のプロパティにデフォルト値が設定されていると考えます。

(b)について「**基本的に**コンテンツスロット」としたのは、画像やフォームの入力要素のような部品があるためです。上記の特性の考え方だと(a)になるようにも思えますが、部品の末端要素として生じるため(b)として分類しました。

まとめると次のようになります。便宜上、前者を「ビューコンポーネント」、後者を「パーツコンポーネント」と呼ぶことにします。

- **(a) ビューコンポーネント：DBやAPIから受け取ったデータを表示**
  - **コンテンツ用プロパティはプリミティブ型、オブジェクト、配列である (JSX要素やHTML要素ではない)**
- **(b) パーツコンポーネント: 別のUIコンポーネントを差し込んで表示**
  - **コンテンツ用プロパティは基本的にコンテンツスロットである (JSX要素やHTML要素)**
  - **画像やフォームの入力要素のようにコンテンツ用プロパティがコンテンツスロットでない場合がある**

ビューコンポーネントはアトミックデザインのPageとOrganismを統合した考え方と言えます。Pageか否かによる区別を廃しました。

次にビューコンポーネント、パーツコンポーネントの説明を示します。

## ビューコンポーネント：データの表示

ビューコンポーネントは、DBやAPIから受け取ったデータを表示します。また、ビューコンポーネント自身が動的にデータを取得する場合もあります。たとえば、非同期でAPIからデータを取得し、その結果をレンダリングすることが考えられます。

ビューコンポーネントは次の責任を持ちます。

- データのフォーマット : 金額や日付などのデータを適切な形式に整形して表示
- パーツコンポーネントの選択 : 表示内容に応じて必要なパーツコンポーネントを組み合わせて表示
- (必要であれば)データのロード : 必要に応じてAPIからデータを取得
- ボタンの動作 : ユーザーインタラクションに応じた動作

配置・装飾・インタラクションなどを全てパーツコンポーネントに任せることで、ビューコンポーネントは複雑な処理に集中できます。

複雑な処理が散らばっていると、全体像の把握が難しくなります。そのためビューコンポーネントに複雑な処理を集約することで、コードの可読性が向上し、他の開発者が関わった際にも理解しやすくなります。これにより、保守作業の負担も軽減されることが期待できます。

> [!WARNING] 複雑な処理の集約を過剰に行うと、過度に複雑になり、保守が難しくなります。適切に分割・集約するバランスが重要です。必要に応じて、さらに別のビューコンポーネントに分離することも検討してください。

## パーツコンポーネント: 組み合わせて使う部品

パーツコンポーネントはビューコンポーネントを構成する部品です。

複数のUIコンポーネントの組み合わせを前提とし、別のUIコンポーネントを差し込んで表示します。

パーツコンポーネントは次の責任を持ちます。

- スタイル : 表示やレイアウトに関連するスタイルを担当する

パーツコンポーネントは役割をスタイルのみに特化させることで換装や再利用しやすくします。

次にパーツコンポーネントについてさらに詳細に分類します。

筆者の経験を基に考えると、概ね次のようになるのではないかと考えます。

- (b.1) 配置と装飾 (テンプレート)
- (b.2) 表示ギミック : Modal, Accordion, Toast, Tab, Hamburger, ...
- (b.3) 基礎的なパーツ
  - (b.3.1) 並び方と余白 (レイアウト) : List, Table, Flexbox, ...
  - (b.3.2) ボタン
  - (b.3.3) 入力要素 : input, select, checkbox, radio, textbox, ...
  - (b.3.4) テキスト
  - (b.3.5) 画像・図形などの視覚的表現 : Image, Icon, QRCode, ...

### 配置と装飾 (テンプレート)

(b.1)「配置と装飾」は、子要素の配置、枠線、背景などを担当します。子要素は1つとは限らず、複数の場合もあります。例えば、見出しと主コンテンツを持つUIコンポーネントは、2つの子要素を持つUIコンポーネントです。

アトミックデザインのTemplateの考え方が近いですが、アトミックデザインのようにPageに限定することはありません。

ここまでの記述でアトミックデザインのMoleculeに相当するUIコンポーネントはありませんが、あえて言えば小さな「ビューコンポーネント」や小さな「配置と装飾」がMoleculeだと考えることができます。

### 表示ギミック

(b.2)「表示ギミック」は、UI上での動的な表示やインタラクションに関する仕掛けです。具体的にはモーダル、アコーディオン、トースト、タブなどが該当します。

これらは、モーダルの表示・非表示やアコーディオンの開閉など、JavaScriptやCSSを使った動きの制御が特徴です。

「配置と装飾」にまとめることも考えましたが、これらは視覚的な要素の配置や装飾とは異なり、動的な動作やインタラクションを伴うため、別のカテゴリに分類する方が分かりやすいと判断しました。

### 基礎的なパーツ

 (b.3.1)「並び方と余白」、(b.3.2)「ボタン」、(b.3.3)「入力要素」、(b.3.4)「テキスト」、(b.3.5)「画像・図形などの視覚的表現」は、イメージしやすい基礎的なパーツです。

アトミックデザインのAtomに相当する考え方です。

- 「並び方と余白」は、子要素の並び方や余白を担当します。List, Table, Flexboxなどのレイアウトを想定しています。要素間のスペースや配置を管理します。
- 「ボタン」は、ボタンやメニュー項目などが該当します。ボタンの動作がフォームのsubmitなのか、JavaScriptなのか、またはリンク(`a`)なのかは関係ありません。いずれの場合でも本質としてボタンであることに変わりがないためです。
- 「入力要素」は、`input`、`select`、`checkbox`、`radio`、`textbox`などが含まれます。フレームワークによってはスライダーやスイッチのような入力要素も考えられます。
- 「テキスト」は、単純なテキスト表示を指します。修飾が加えられたテキスト(`em`/`strong`/`del`/`span`など)も含まれます。
- 「画像・図形などの視覚的表現」は、アイコンや画像、図形などです。

「並び方と余白」は「配置と装飾」にまとめることも考えましたが、個々の要素の配置や余白を別途扱うことで、UIコンポーネントの組み合わせにおける柔軟性が向上すると考え、別のグループとして分類しました。

# 例

以下に本記事で示したガイドラインに基づいてUIコンポーネントを示します。

ProductPage：

```jsx
<PageTemplate
  header={<PageHeader>製品紹介</PageHeader>}
  footer={<PageFooter />}
  >
  <ProductView data={data} />
</PageTemplate>
```

ProductView：

```jsx
<ProductViewTemplate title={<SubTitle>{data.title}</SubTitle>}>
  <Image src={data.imageUrl} />
  <SpecList>
    <SpecList.Item>
      <ProductLabel>金額</ProductLabel>
      <ProductText>{Number(data.unitPrice).toLocaleString()}</ProductText>
    </SpecList.Item>
    <SpecList.Item>
      <ProductLabel>製品番号</ProductLabel>
      <ProductText>{data.productNo}</ProductText>
    </SpecList.Item>
    <SpecList.Item>
      <ProductLabel>製品モデル</ProductLabel>
      <ProductText>{data.productModel}</ProductText>
    </SpecList.Item>
    <SpecList.Item>
      <ProductLabel>サイズ</ProductLabel>
      <ProductText>{data.productSize}</ProductText>
    </SpecList.Item>
  </SpecList>
  <Accordion>
    <AccordionItem>
      <AccordionButton>詳細情報</AccordionButton>
      <AccordionPanel>{/*省略*/}</AccordionPanel >
    </AccordionItem>
  </Accordion>
  <Stack>
    <ProductLabel>購入数</ProductLabel>
    <Input name="num" type="number" />
  </Stack>
  <Stack>
    <BuyButton onClick={/*省略*/}/>
    <BackButton onClick={/*省略*/}/>
  </Stack>
</ProductViewTemplate>
```

この例で使われているUIコンポーネントは、本記事で示したUIコンポーネントの分類に当てはめると次のようになります。

- ビューコンポーネント ... ProductPage、PageHeader、PageFooter、ProductView、
- パーツコンポーネント
  - (b.1) 配置と装飾 (テンプレート) ... PageTemplate、ProductViewTemplate
  - (b.2) 表示ギミック ... Accordion
  - (b.3) 基礎的なパーツ
    - (b.3.1) 並び方と余白 (レイアウト) ... SpecList, Stack
    - (b.3.2) ボタン ... BuyButton, BackButton
    - (b.3.3) 入力要素 ... Input
    - (b.3.4) テキスト ... ProductLabel、ProductText
    - (b.3.5) 画像・図形などの視覚的表現 ... Image

# まとめ

以上、UIコンポーネントのガイドラインとUIコンポーネントの分類でした。

本ガイドラインがUIコンポーネント作成の参考になれば幸いです。

また、UIコンポーネント設計において有名なアトミックデザインの手法を学ぶことは役立つかもしれません。実際に採用しなくても、その考え方や知見は有益です。
