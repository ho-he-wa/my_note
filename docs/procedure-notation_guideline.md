# 手順記述のガイドライン

業務や処理の手順をスッキリ、わかりやすく書くためのルールをまとめたものです。
書く側も読む側も迷わず使えることを目指しています。

このガイドラインの記述法は、まず大まかな流れ（大枠）を書いてから、必要に応じて段階的に詳細化できるのが特徴です。
処理の全体像を早く把握しやすく、あとから条件分岐やサブ処理を自然に追加できるため、設計・レビュー・メンテナンスまで幅広く対応できます。

複数人で共有・レビューするような場面で、とくに役立つはずです。

※基本的にMarkdownでの記述を想定していますが、Wordなどのリッチテキストドキュメントでも利用できます。

---

## 構成

基本的な構成は次のとおりである。

```markdown
# ◯◯◯の手順
## 方針

- 方針1
- 方針2
- 方針3

## 前提条件

- 前提条件1
- 前提条件2
- 前提条件3

## 手順

※後述の「手順の書き方」で示すルールに従って記述する。

1. ZZZデータを取得する
    - 条件: 
        - 条件a: xxx
        - 条件b: xxx
        - 条件c: xxx
2. ZZZデータをそれぞれに対して繰り返す
    1. XXXであるか？
        - 条件: xxx
        - Yes =>
            1. xxxする
            2. xxxする
            3. xxxする
    2. YYYであるか？
        - 条件: xxx
        - No =>
            1. xxxする

## 補足・注記

- 補足1
- 補足2
- 補足3
```

---

## 手順の書き方

### 表記ルール

| 記法        | 意味                    | 例                  |
| --------- | --------------------- | ------------------ |
| `<<xxx>>` | サブ処理（共通処理など）          | `<<ユーザ認証処理>>を実行する` |
| `[xxx]`   | 明示的なデータ名・オブジェクト名      | `[ユーザ情報]を更新する`     |
| `:`       | 具体化。`a: b` → 「aはbである」 | `状態: 有効`           |
| `=>`      | 条件下での処理。「aの場合、bを行う」   | `Yes => 保存する`      |

※フォントや環境によって `<<>>` の見た目が気になる場合は、代わりに全角の `《》` を使っても構いません。

---

### 基本構文

手順の基本は「〜する」の形式で、動詞の現在形を使う。

```markdown
1. xxxする
```

手順を詳細化する場合は、階層構造で記述する。

```markdown
1. xxxする
    1. aaaする
    2. bbbする
```

属性や条件を記述する場合は、箇条書きで表現する。

```markdown
- xxxであるか？
    - 条件: aaaがxxxである
```

さらに細かい条件は階層化して明示する。

```markdown
- xxxであるか？
    - 条件:
        - aa: xxx
        - bb: xxx
        - cc: xxx
```

手順に補足や注意などの手順以外を含む場合は次のように記述する。

```markdown
1. xxxする
    - 説明: xxxをxxxするための処理である。
    - 注意:
        - 注意1: xxxに注意すること。
        - 注意2: yyyは行わないこと。
    - 処理:
        1. aaaする
        2. bbbする
```

---

### サブ処理の記述

大きな処理のまとまりや共通処理は、サブ処理（`<<名前>>`）として定義する。

```markdown
1. <<データ正規化処理>>を実行する

（※以降は別定義箇所に記述）

<<データ正規化処理>>
1. フィールドを正規化する
2. 不要項目を削除する
3. 正規化されたデータを返す
```

パラメータや戻り値を明示する場合は次のように記述する。

```markdown
1. <<データ正規化処理>>を実行し、[正規化済データ]を導出する。
    - 対象データ: xxx

（※以降は別定義箇所に記述）

<<データ正規化処理>>
1. パラメータを受け取る
    - 対象データ: 正規化対象のデータ
2. フィールドを正規化する
3. 不要項目を削除する
4. 正規化されたデータを返す
    - 正規化済データ: 正規化されたデータ
    - ステータス: 成功／失敗
```

---

### 値の導出

計算や条件判定により値を導出する場合は、明示的に記述する。

例:

```markdown
1. [稼働状態]を導出する
    - [稼働状態]: 過去1時間の稼働実績に[active]が1件以上あるならばTrue
```

---

### 条件分岐

#### 略式記法

簡単な条件は自然言語風に記述する。

```markdown
1. もしもエラーが発生した場合、処理を中断する。
2. もしもユーザが未ログインならば、ログイン画面へ遷移する。
```

---

#### if式（Yes/No）

簡易版：

```markdown
1. データは存在するか？
    - Yes =>
        1. 処理を継続する
    - No =>
        1. エラーメッセージを返す
```

※ 簡易版では詳細版と異なり、条件（`- 条件:`）を明示しない。
※ `Yes` / `No` は必要な方のみ記述してよい（例：Yesのみ、Noのみでも可）。
※ 処理の意図が明確であれば、簡易版で十分である。

詳細版（条件・処理を分離）：

```markdown
1. データは存在するか？
    - 条件: [検索結果]が空でない
    - Yes =>
        1. 処理を継続する
    - No =>
        1. エラーメッセージを返す
```

※ `Yes` / `No` は必要な方のみ記述してよい。

---

#### switch式（複数分岐）

簡易版：

```markdown
1. ステータスによって処理を分岐する
    - 完了である =>
        1. アーカイブ処理する
    - 保留である =>
        1. 再確認通知を送信する
    - エラーである =>
        1. エラーログを記録する
```

※ 簡易版では各状態に対する条件は省略し、処理のみを記述する。
※ 状態数が少なく、条件が明確な場合は簡易版で十分である。

詳細版（条件・処理を分離）：

```markdown
1. ステータスによって処理を分岐する
    - 完了であるか？
        - 条件: [状態]は「完了」である
        - Yes =>
            1. アーカイブ処理する
    - 保留であるか？
        - 条件: [状態]は「保留」である
        - Yes =>
            1. 再確認通知を送信する
    - エラーであるか？
        - 条件: [状態]は「エラー」である
        - Yes =>
            1. エラーログを記録する
```

---

## おわりに

書き方がそろうと、読む側も書く側もストレスが減ります。
必要に応じてカスタマイズしながら、チームやプロジェクトに合った形で使ってください。

---

# (Appendix) 記述例：月次レポートの作成・配信手順

## 方針

* 毎月初営業日に自動または手動でレポートを作成する
* レポートはPDF形式で出力し、対象ユーザにメールで配信する
* 失敗時はエラーログを記録し、管理者に通知する

## 前提条件

* [売上データ]と[ユーザ情報]が前月分まで登録済みであること
* 配信対象ユーザがアクティブ状態であること
* 実行環境にPDF生成ツールがインストールされていること

## 手順

1. [対象月]を設定する

   * 説明: 前月の月初〜月末を対象期間とする
   * 注意:

     * 手動実行時は[対象月]を誤らないこと

2. [売上データ]を取得する

   * 条件:

     * 対象月: 設定された月
     * ステータス: 確定済み

3. 対象ユーザを取得する

   * 条件:

     * ステータス: アクティブ
     * レポート配信設定: ON

4. <<レポート生成処理>>を実行し、[月次レポート]を作成する

   * 対象: [売上データ], [対象ユーザ]

5. [月次レポート]の件数を確認する

   * 条件: [月次レポート]の件数 > 0
   * Yes =>

     1. <<メール配信処理>>を実行する
   * No =>

     1. ログ出力のみ行い、処理終了する

### <<レポート生成処理>>

1. レポートテンプレートを読み込む
2. 各ユーザごとにPDFを生成する
3. [月次レポート]に格納する

### <<メール配信処理>>

1. メールテンプレートを読み込む
2. 各ユーザにPDFを添付して送信する
3. 成功件数・失敗件数をログに記録する

## 補足・注記

* 月次処理は初営業日の8:00に自動実行される
* エラー発生時はSlack通知も送信される（別途設定）
